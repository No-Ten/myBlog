

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/myBlog/img/fluid.png">
  <link rel="icon" href="/myBlog/img/browserTitle.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Ten">
  <meta name="keywords" content="">
  
    <meta name="description" content="Day12-登录业务登录业务介绍（单点登录） Jwt介绍 整合JWT令牌1、在common_utils模块中添加jwt工具依赖在pom中添加 &lt;dependencies&gt;     &lt;!-- JWT --&gt;     &lt;dependency&gt;         &lt;groupId&gt;io.jsonwebtoken&lt;&#x2F;groupId&gt;">
<meta property="og:type" content="article">
<meta property="og:title" content="day12-登录业务">
<meta property="og:url" content="https://no-ten.github.io/day12-%E7%99%BB%E5%BD%95%E4%B8%9A%E5%8A%A1/index.html">
<meta property="og:site_name" content="TBlog">
<meta property="og:description" content="Day12-登录业务登录业务介绍（单点登录） Jwt介绍 整合JWT令牌1、在common_utils模块中添加jwt工具依赖在pom中添加 &lt;dependencies&gt;     &lt;!-- JWT --&gt;     &lt;dependency&gt;         &lt;groupId&gt;io.jsonwebtoken&lt;&#x2F;groupId&gt;">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://no-ten.github.io/myBlog/day12-%E7%99%BB%E5%BD%95%E4%B8%9A%E5%8A%A1/image-20220107000233656.png">
<meta property="og:image" content="https://no-ten.github.io/myBlog/day12-%E7%99%BB%E5%BD%95%E4%B8%9A%E5%8A%A1/image-20220107000249450.png">
<meta property="og:image" content="https://no-ten.github.io/myBlog/day12-%E7%99%BB%E5%BD%95%E4%B8%9A%E5%8A%A1/image-20220107000552998.png">
<meta property="og:image" content="https://no-ten.github.io/myBlog/day12-%E7%99%BB%E5%BD%95%E4%B8%9A%E5%8A%A1/image-20220107000912160.png">
<meta property="og:image" content="https://no-ten.github.io/myBlog/day12-%E7%99%BB%E5%BD%95%E4%B8%9A%E5%8A%A1/image-20220107000936830.png">
<meta property="article:published_time" content="2022-01-06T16:02:07.675Z">
<meta property="article:modified_time" content="2022-01-07T02:19:26.320Z">
<meta property="article:author" content="Ten">
<meta property="article:tag" content="project">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://no-ten.github.io/myBlog/day12-%E7%99%BB%E5%BD%95%E4%B8%9A%E5%8A%A1/image-20220107000233656.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>day12-登录业务 - TBlog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/prism/1.26.0/plugins/line-numbers/prism-line-numbers.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/myBlog/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/myBlog/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/myBlog/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"no-ten.github.io","root":"/myBlog/","version":"1.9.0","typing":{"enable":true,"typeSpeed":230,"cursorChar":"_","loop":true,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/myBlog/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/myBlog/js/utils.js" ></script>
  <script  src="/myBlog/js/color-schema.js" ></script>

  
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/myBlog/atom.xml" title="TBlog" type="application/atom+xml">
</head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/myBlog/">
      <strong>TBlog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/myBlog/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/myBlog/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/myBlog/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/myBlog/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/myBlog/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/myBlog/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="day12-登录业务"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        Ten
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-01-07 00:02" pubdate>
          2022年1月7日凌晨12点02分 
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          30k 字
        
      </span>
    

    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">day12-登录业务</h1>
            
            <div class="markdown-body">
              
              <h1 id="Day12-登录业务"><a href="#Day12-登录业务" class="headerlink" title="Day12-登录业务"></a>Day12-登录业务</h1><h1 id="登录业务介绍（单点登录）"><a href="#登录业务介绍（单点登录）" class="headerlink" title="登录业务介绍（单点登录）"></a>登录业务介绍（单点登录）</h1><p><img src="/myBlog/day12-%E7%99%BB%E5%BD%95%E4%B8%9A%E5%8A%A1/image-20220107000233656.png" srcset="/myBlog/img/loading.gif" lazyload alt="image-20220107000233656"></p>
<h1 id="Jwt介绍"><a href="#Jwt介绍" class="headerlink" title="Jwt介绍"></a>Jwt介绍</h1><p><img src="/myBlog/day12-%E7%99%BB%E5%BD%95%E4%B8%9A%E5%8A%A1/image-20220107000249450.png" srcset="/myBlog/img/loading.gif" lazyload alt="image-20220107000249450"></p>
<h1 id="整合JWT令牌"><a href="#整合JWT令牌" class="headerlink" title="整合JWT令牌"></a>整合JWT令牌</h1><h2 id="1、在common-utils模块中添加jwt工具依赖"><a href="#1、在common-utils模块中添加jwt工具依赖" class="headerlink" title="1、在common_utils模块中添加jwt工具依赖"></a>1、在common_utils模块中添加jwt工具依赖</h2><p>在pom中添加</p>
<div class="code-wrapper"><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml">&lt;dependencies&gt;
    &lt;!-- JWT --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;io.jsonwebtoken&lt;&#x2F;groupId&gt;
        &lt;artifactId&gt;jjwt&lt;&#x2F;artifactId&gt;
    &lt;&#x2F;dependency&gt;
&lt;&#x2F;dependencies&gt;</code></pre></div>

<h2 id="创建JWT工具类"><a href="#创建JWT工具类" class="headerlink" title="创建JWT工具类"></a>创建JWT工具类</h2><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java">public class JwtUtils &#123;

    &#x2F;&#x2F; 常量
    public static final long EXPIRE &#x3D; 1000 * 60 * 60 * 24;     &#x2F;&#x2F; token过期时间
    public static final String APP_SECRET &#x3D; &quot;ukc8BDbRigUDaY6pZFfWus2jZWLPHO&quot;;   &#x2F;&#x2F; 秘钥

    &#x2F;&#x2F; 生成token字符串的方法
    public static String getJwtToken(String id, String nickname)&#123;

        String JwtToken &#x3D; Jwts.builder()
                &#x2F;&#x2F; 头信息
                .setHeaderParam(&quot;typ&quot;, &quot;JWT&quot;)
                .setHeaderParam(&quot;alg&quot;, &quot;HS256&quot;)

                .setSubject(&quot;guli-user&quot;)
                .setIssuedAt(new Date())
                .setExpiration(new Date(System.currentTimeMillis() + EXPIRE))

                .claim(&quot;id&quot;, id)    &#x2F;&#x2F; 设置token主体部分，存储用户信息
                .claim(&quot;nickname&quot;, nickname)
                .signWith(SignatureAlgorithm.HS256, APP_SECRET)
                .compact();
        return JwtToken;
    &#125;

    &#x2F;**
     * 判断token是否存在与有效
     * @param jwtToken
     * @return
     *&#x2F;
    public static boolean checkToken(String jwtToken) &#123;
        if(StringUtils.isEmpty(jwtToken)) return false;
        try &#123;
            Jwts.parser().setSigningKey(APP_SECRET).parseClaimsJws(jwtToken);
        &#125; catch (Exception e) &#123;
            e.printStackTrace();
            return false;
        &#125;
        return true;
    &#125;

    &#x2F;**
     * 判断token是否存在与有效
     * @param request
     * @return
     *&#x2F;
    public static boolean checkToken(HttpServletRequest request) &#123;
        try &#123;
            String jwtToken &#x3D; request.getHeader(&quot;token&quot;);
            if(StringUtils.isEmpty(jwtToken)) return false;
            Jwts.parser().setSigningKey(APP_SECRET).parseClaimsJws(jwtToken);
        &#125; catch (Exception e) &#123;
            e.printStackTrace();
            return false;
        &#125;
        return true;
    &#125;

    &#x2F;**
     * 根据token获取会员id
     * @param request
     * @return
     *&#x2F;
    public static String getMemberIdByJwtToken(HttpServletRequest request) &#123;
        String jwtToken &#x3D; request.getHeader(&quot;token&quot;);
        if(StringUtils.isEmpty(jwtToken)) return &quot;&quot;;
        Jws&lt;Claims&gt; claimsJws &#x3D; Jwts.parser().setSigningKey(APP_SECRET).parseClaimsJws(jwtToken);
        Claims claims &#x3D; claimsJws.getBody();
        return (String)claims.get(&quot;id&quot;);
    &#125;

&#125;</code></pre></div>



<h1 id="整合阿里云短信"><a href="#整合阿里云短信" class="headerlink" title="整合阿里云短信"></a>整合阿里云短信</h1><h2 id="新建短信微服务"><a href="#新建短信微服务" class="headerlink" title="新建短信微服务"></a>新建短信微服务</h2><p>1、在service模块下创建子模块service-msm</p>
<p>2、创建controller和service代码</p>
<p>3、配置application.properties</p>
<div class="code-wrapper"><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"># 服务端口
server.port&#x3D;8005

# 服务名
spring.application.name&#x3D;service-msm

# mysql数据库连接
spring.datasource.driver-class-name&#x3D;com.mysql.cj.jdbc.Driver
spring.datasource.url&#x3D;jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;guli?serverTimezone&#x3D;GMT%2B8
spring.datasource.username&#x3D;root
spring.datasource.password&#x3D;root

# redis
spring.redis.host&#x3D;192.168.242.3
spring.redis.password&#x3D;123456
spring.redis.port&#x3D;6379
spring.redis.database&#x3D; 0
spring.redis.timeout&#x3D;1800000
spring.redis.lettuce.pool.max-active&#x3D;20
spring.redis.lettuce.pool.max-wait&#x3D;-1

#最大阻塞等待时间(负数表示没限制)
spring.redis.lettuce.pool.max-idle&#x3D;5
spring.redis.lettuce.pool.min-idle&#x3D;0

#最小空闲
#返回json的全局时间格式
spring.jackson.date-format&#x3D;yyyy-MM-dd HH:mm:ss
spring.jackson.time-zone&#x3D;GMT+8

#配置mapper xml文件的路径
mybatis-plus.mapper-locations&#x3D;classpath:com&#x2F;atguigu&#x2F;edumsm&#x2F;mapper&#x2F;xml&#x2F;*.xml

#mybatis日志
mybatis-plus.configuration.log-impl&#x3D;org.apache.ibatis.logging.stdout.StdOutImpl</code></pre></div>

<p>4、创建启动类</p>
<p>创建MsmApplication.java</p>
<div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java">@ComponentScan(&#123;&quot;com.atguigu&quot;&#125;)
@SpringBootApplication(exclude &#x3D; DataSourceAutoConfiguration.class)     &#x2F;&#x2F; 去掉数据库自动装配
public class MsmApplication &#123;

    public static void main(String[] args) &#123;
        SpringApplication.run(MsmApplication.class,args);
    &#125;

&#125;</code></pre></div>

<h2 id="编写发送短信接口"><a href="#编写发送短信接口" class="headerlink" title="编写发送短信接口"></a>编写发送短信接口</h2><p>1、在service-msm的pom中引入依赖</p>
<div class="code-wrapper"><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml">&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.alibaba&lt;&#x2F;groupId&gt;
        &lt;artifactId&gt;fastjson&lt;&#x2F;artifactId&gt;
    &lt;&#x2F;dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.aliyun&lt;&#x2F;groupId&gt;
        &lt;artifactId&gt;aliyun-java-sdk-core&lt;&#x2F;artifactId&gt;
    &lt;&#x2F;dependency&gt;
&lt;&#x2F;dependencies&gt;</code></pre></div>

<p>2、编写controller，根据手机号发送短信</p>
<div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java">@RestController
@RequestMapping(&quot;&#x2F;edumsm&#x2F;msm&quot;)
@CrossOrigin
public class MsmController &#123;

    @Autowired
    private MsmService msmService;

    @Autowired
    private RedisTemplate&lt;String,String&gt; redisTemplate;

    &#x2F;&#x2F; 发送验证码
    @GetMapping(value &#x3D; &quot;send&#x2F;&#123;phone&#125;&quot;)
    public R code(@PathVariable String phone) &#123;

        &#x2F;&#x2F; 1.先从redis中查询，如果查询出来就发送
        String code &#x3D; redisTemplate.opsForValue().get(phone);
        if (!StringUtils.isEmpty(code))&#123;
            return R.ok();
        &#125;

        &#x2F;&#x2F; 2.查询不出来，在发送阿里云短信
        &#x2F;&#x2F; 随机生成验证码
        code &#x3D; RandomUtil.getFourBitRandom();

        Map&lt;String,Object&gt; param &#x3D; new HashMap&lt;&gt;();

        param.put(&quot;code&quot;, code);
        boolean isSend &#x3D; msmService.send(phone, param);
        if(isSend) &#123;
            redisTemplate.opsForValue().set(phone,code,5,TimeUnit.MINUTES);
            return R.ok();
        &#125; else &#123;
            return R.error().message(&quot;发送短信失败&quot;);
        &#125;
    &#125;
&#125;</code></pre></div>

<p>3、编写service</p>
<div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java">@Service
public class MsmServiceImpl implements MsmService &#123;

    &#x2F;&#x2F; 发送验证码
    @Override
    public boolean send(String phone, Map&lt;String, Object&gt; param) &#123;
        if(StringUtils.isEmpty(phone)) return false;
        DefaultProfile profile &#x3D;
                DefaultProfile.getProfile(&quot;default&quot;, &quot;LTAIq6nIPY09VROj&quot;, &quot;FQ7UcixT9wEqMv9F35nORPqKr8XkTF&quot;);
        IAcsClient client &#x3D; new DefaultAcsClient(profile);
        CommonRequest request &#x3D; new CommonRequest();
        &#x2F;&#x2F;request.setProtocol(ProtocolType.HTTPS);
        request.setMethod(MethodType.POST);

        request.setDomain(&quot;dysmsapi.aliyuncs.com&quot;);
        request.setVersion(&quot;2017-05-25&quot;);
        request.setAction(&quot;SendSms&quot;);

        request.putQueryParameter(&quot;PhoneNumbers&quot;, phone);
        request.putQueryParameter(&quot;SignName&quot;, &quot;我的谷粒在线教育网站&quot;);
        request.putQueryParameter(&quot;TemplateCode&quot;, &quot;SMS_180051135&quot;);
        request.putQueryParameter(&quot;TemplateParam&quot;, JSONObject.toJSONString(param));

        try &#123;
            CommonResponse response &#x3D; client.getCommonResponse(request);
            System.out.println(response.getData());
            return response.getHttpResponse().isSuccess();
        &#125; catch (Exception e) &#123;
            e.printStackTrace();
        &#125;
        return false;
    &#125;
&#125;</code></pre></div>



<h2 id="云市场的短信验证码接收"><a href="#云市场的短信验证码接收" class="headerlink" title="云市场的短信验证码接收"></a>云市场的短信验证码接收</h2><p>这里我使用的是阿里云的云市场的，不用阿里云的短信服务</p>
<p>Controller</p>
<div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java">&#x2F;&#x2F; 用阿里云的云市场短信服务
@GetMapping(&quot;sendByPhone&#x2F;&#123;phone&#125;&quot;)
public R sendByPhone(@PathVariable String phone)&#123;

    &#x2F;&#x2F; 1.先从redis中取验证码
    String code &#x3D; redisTemplate.opsForValue().get(phone);
    if (!StringUtils.isEmpty(code))&#123;
        return R.ok();
    &#125;

    code &#x3D; RandomUtil.getFourBitRandom();

    &#x2F;&#x2F; 2.如果redis没有，再发送短信
    boolean isSend &#x3D; msmService.sendCodeByPhone(phone,code);

    if (isSend)&#123;
        redisTemplate.opsForValue().set(phone,code,5,TimeUnit.MINUTES);
        return R.ok();
    &#125; else &#123;
        return R.error().message(&quot;发送验证码失败&quot;);
    &#125;

&#125;</code></pre></div>

<p>serviceImpl</p>
<div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java">&#x2F;&#x2F; 用阿里云的云市场短信服务
@Override
public boolean sendCodeByPhone(String phone, String code) &#123;

    if(StringUtils.isEmpty(phone)) return false;

    String host &#x3D; &quot;https:&#x2F;&#x2F;gyytz.market.alicloudapi.com&quot;;
    String path &#x3D; &quot;&#x2F;sms&#x2F;smsSend&quot;;
    String method &#x3D; &quot;POST&quot;;
    String appcode &#x3D; &quot;9……………2&quot;;

    Map&lt;String, String&gt; headers &#x3D; new HashMap&lt;String, String&gt;();

    &#x2F;&#x2F;最后在header中的格式(中间是英文空格)为Authorization:APPCODE 83359fd73fe94948385f570e3c139105
    headers.put(&quot;Authorization&quot;, &quot;APPCODE &quot; + appcode);

    Map&lt;String, String&gt; querys &#x3D; new HashMap&lt;String, String&gt;();

    querys.put(&quot;mobile&quot;, phone);
    querys.put(&quot;param&quot;, &quot;**code**:&quot;+code+&quot;,**minute**:5&quot;);
    querys.put(&quot;smsSignId&quot;, &quot;2e65b1bb3d054466b82f0c9d125465e2&quot;);
    querys.put(&quot;templateId&quot;, &quot;908e94ccf08b4476ba6c876d13f084ad&quot;);
    Map&lt;String, String&gt; bodys &#x3D; new HashMap&lt;String, String&gt;();


    try &#123;
        &#x2F;**
         * 重要提示如下:
         * HttpUtils请从
         * https:&#x2F;&#x2F;github.com&#x2F;aliyun&#x2F;api-gateway-demo-sign-java&#x2F;blob&#x2F;master&#x2F;src&#x2F;main&#x2F;java&#x2F;com&#x2F;aliyun&#x2F;api&#x2F;gateway&#x2F;demo&#x2F;util&#x2F;HttpUtils.java
         * 下载
         *
         * 相应的依赖请参照
         * https:&#x2F;&#x2F;github.com&#x2F;aliyun&#x2F;api-gateway-demo-sign-java&#x2F;blob&#x2F;master&#x2F;pom.xml
         *&#x2F;
        HttpResponse response &#x3D; HttpUtils.doPost(host, path, method, headers, querys, bodys);
        System.out.println(response.toString());
        &#x2F;&#x2F;获取response的body
        &#x2F;&#x2F;System.out.println(EntityUtils.toString(response.getEntity()));
        return true;
    &#125; catch (Exception e) &#123;
        e.printStackTrace();
        return false;
    &#125;

&#125;</code></pre></div>



<h1 id="登录功能接口"><a href="#登录功能接口" class="headerlink" title="登录功能接口"></a>登录功能接口</h1><h2 id="新建用户微服务"><a href="#新建用户微服务" class="headerlink" title="新建用户微服务"></a>新建用户微服务</h2><h3 id="1、在service模块下创建子模块service-ucenter"><a href="#1、在service模块下创建子模块service-ucenter" class="headerlink" title="1、在service模块下创建子模块service-ucenter"></a>1、在service模块下创建子模块service-ucenter</h3><h3 id="2、使用代码生成器生成代码"><a href="#2、使用代码生成器生成代码" class="headerlink" title="2、使用代码生成器生成代码"></a>2、使用代码生成器生成代码</h3><p>（1）创建ucenter_member表</p>
<p><img src="/myBlog/day12-%E7%99%BB%E5%BD%95%E4%B8%9A%E5%8A%A1/image-20220107000552998.png" srcset="/myBlog/img/loading.gif" lazyload alt="image-20220107000552998"></p>
<p>生成代码</p>
<h3 id="3、配置application-properties"><a href="#3、配置application-properties" class="headerlink" title="3、配置application.properties"></a>3、配置application.properties</h3><div class="code-wrapper"><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"># 服务端口
server.port&#x3D;8006

# 服务名
spring.application.name&#x3D;service-ucenter

# mysql数据库连接
spring.datasource.driver-class-name&#x3D;com.mysql.cj.jdbc.Driver
spring.datasource.url&#x3D;jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;guli?serverTimezone&#x3D;GMT%2B8
spring.datasource.username&#x3D;root
spring.datasource.password&#x3D;root

spring.redis.host&#x3D;192.168.242.3
spring.redis.password&#x3D;123456
spring.redis.port&#x3D;6379
spring.redis.database&#x3D; 0
spring.redis.timeout&#x3D;1800000
spring.redis.lettuce.pool.max-active&#x3D;20
spring.redis.lettuce.pool.max-wait&#x3D;-1

#最大阻塞等待时间(负数表示没限制)
spring.redis.lettuce.pool.max-idle&#x3D;5
spring.redis.lettuce.pool.min-idle&#x3D;0

#最小空闲
#返回json的全局时间格式
spring.jackson.date-format&#x3D;yyyy-MM-dd HH:mm:ss
spring.jackson.time-zone&#x3D;GMT+8

#配置mapper xml文件的路径
mybatis-plus.mapper-locations&#x3D;classpath:com&#x2F;atguigu&#x2F;educenter&#x2F;mapper&#x2F;xml&#x2F;*.xml

#mybatis日志
mybatis-plus.configuration.log-impl&#x3D;org.apache.ibatis.logging.stdout.StdOutImpl</code></pre></div>



<h3 id="创建启动类"><a href="#创建启动类" class="headerlink" title="创建启动类"></a>创建启动类</h3><p>创建ServiceUcApplication.java</p>
<div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java">@SpringBootApplication
@ComponentScan(&#123;&quot;com.atguigu&quot;&#125;)     &#x2F;&#x2F; 整合swagger
@MapperScan(&quot;com.atguigu.educenter.mapper&quot;) &#x2F;&#x2F; 扫描mapper
public class UcenterApplication &#123;

    public static void main(String[] args) &#123;
        SpringApplication.run(UcenterApplication.class,args);
    &#125;

&#125;</code></pre></div>



<h2 id="创建登录接口"><a href="#创建登录接口" class="headerlink" title="创建登录接口"></a>创建登录接口</h2><h3 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h3><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java">@RestController
@RequestMapping(&quot;&#x2F;educenter&#x2F;member&quot;)
@CrossOrigin
public class UcenterMemberController &#123;

    @Autowired
    private UcenterMemberService memberService;

    &#x2F;&#x2F; 登录
    @GetMapping(&quot;login&quot;)
    public R login(@RequestBody UcenterMember member)&#123;
        String token &#x3D; memberService.login(member);
&#x2F;&#x2F; 返回token，用jwt生成

        return R.ok().data(&quot;token&quot;,token);
    &#125;

    &#x2F;&#x2F; 注册


&#125;</code></pre></div>

<h3 id="ServiceImpl"><a href="#ServiceImpl" class="headerlink" title="ServiceImpl"></a>ServiceImpl</h3><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java">@Service
public class UcenterMemberServiceImpl extends ServiceImpl&lt;UcenterMemberMapper, UcenterMember&gt; implements UcenterMemberService &#123;

    &#x2F;&#x2F; 登录
@Override
public String login(UcenterMember member) &#123;
    &#x2F;&#x2F; 获取传过来的手机号码和密码
    String mobile &#x3D; member.getMobile();
    String password &#x3D; member.getPassword();

    &#x2F;&#x2F; 判断手机号码是否为空
    if (StringUtils.isEmpty(mobile))&#123;
        throw new GuliException(20001,&quot;登录失败&quot;);
    &#125;
    &#x2F;&#x2F; 判断密码是否为空
    if (StringUtils.isEmpty(password))&#123;
        throw new GuliException(20001,&quot;登录失败&quot;);
    &#125;

    &#x2F;&#x2F; 根据手机号码从数据库中查询对象
    QueryWrapper&lt;UcenterMember&gt; wrapper &#x3D; new QueryWrapper&lt;&gt;();
    wrapper.eq(&quot;mobile&quot;,mobile);
    UcenterMember mobileMember &#x3D; baseMapper.selectOne(wrapper);

    &#x2F;&#x2F; 如果查出来的对象为空
    if (mobileMember &#x3D;&#x3D; null)&#123;
        throw new GuliException(20001,&quot;登录失败&quot;);
    &#125;
    &#x2F;&#x2F; 判断传进来的密码和数据库查出来的是否一致
    &#x2F;&#x2F; 先将传进来的密码加密，再和数据库的比较
    if (!MD5.encrypt(password).equals(mobileMember.getPassword()))&#123;
        throw new GuliException(20001,&quot;登录失败&quot;);
    &#125;

    &#x2F;&#x2F; 判断是否被禁用
    if (mobileMember.getIsDisabled())&#123;
        throw new GuliException(20001,&quot;登录失败&quot;);
    &#125;

    &#x2F;&#x2F; 如果上面的校验都过了，说明可以登录,利用jwt工具生成token，并放回
    String jwtToken &#x3D; JwtUtils.getJwtToken(mobileMember.getId(), mobileMember.getNickname());

    return jwtToken;
&#125;

&#125;</code></pre></div>



<h3 id="MD5"><a href="#MD5" class="headerlink" title="MD5"></a>MD5</h3><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java">import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;


public final class MD5 &#123;

    public static String encrypt(String strSrc) &#123;
        try &#123;
            char hexChars[] &#x3D; &#123; &#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;,
                    &#39;9&#39;, &#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;, &#39;f&#39; &#125;;
            byte[] bytes &#x3D; strSrc.getBytes();
            MessageDigest md &#x3D; MessageDigest.getInstance(&quot;MD5&quot;);
            md.update(bytes);
            bytes &#x3D; md.digest();
            int j &#x3D; bytes.length;
            char[] chars &#x3D; new char[j * 2];
            int k &#x3D; 0;
            for (int i &#x3D; 0; i &lt; bytes.length; i++) &#123;
                byte b &#x3D; bytes[i];
                chars[k++] &#x3D; hexChars[b &gt;&gt;&gt; 4 &amp; 0xf];
                chars[k++] &#x3D; hexChars[b &amp; 0xf];
            &#125;
            return new String(chars);
        &#125; catch (NoSuchAlgorithmException e) &#123;
            e.printStackTrace();
            throw new RuntimeException(&quot;MD5加密出错！！+&quot; + e);
        &#125;
    &#125;


&#125;</code></pre></div>



<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>出现异常</p>
<div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">org.springframework.http.converter.HttpMessageNotReadableException: Required request body is missing: public com.atguigu.commonutils.R com.atguigu.educenter.controller.UcenterMemberController.login(com.atguigu.educenter.entity.UcenterMember)</code></pre></div>

<p>经过排查，发现是controller的注解写错，把@GetMapping改成@PostMapping即可</p>
<h2 id="创建注册接口"><a href="#创建注册接口" class="headerlink" title="创建注册接口"></a>创建注册接口</h2><h3 id="RegisterVo"><a href="#RegisterVo" class="headerlink" title="RegisterVo"></a>RegisterVo</h3><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java">@Data
public class RegisterVo &#123;

   @ApiModelProperty(value &#x3D; &quot;昵称&quot;)
   private String nickname;

   @ApiModelProperty(value &#x3D; &quot;手机号&quot;)
   private String mobile;

   @ApiModelProperty(value &#x3D; &quot;密码&quot;)
   private String password;

   @ApiModelProperty(value &#x3D; &quot;验证码&quot;)
    private String code;
   
&#125;</code></pre></div>

<h3 id="Controller-1"><a href="#Controller-1" class="headerlink" title="Controller"></a>Controller</h3><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java">&#x2F;&#x2F; 注册
@PostMapping(&quot;register&quot;)
public R registerUser(@RequestBody RegisterVo registerVo)&#123;
    memberService.register(registerVo);
    return R.ok();
&#125;</code></pre></div>

<h3 id="serviceImpl"><a href="#serviceImpl" class="headerlink" title="serviceImpl"></a>serviceImpl</h3><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java">&#x2F;&#x2F; 注册
@Override
public void register(RegisterVo registerVo) &#123;
    &#x2F;&#x2F; 获取注册信息
    String nickname &#x3D; registerVo.getNickname();
    String mobile &#x3D; registerVo.getMobile();
    String password &#x3D; registerVo.getPassword();
    String code &#x3D; registerVo.getCode();

    &#x2F;&#x2F; 判断非空
    if (StringUtils.isEmpty(nickname) || StringUtils.isEmpty(mobile)
            || StringUtils.isEmpty(password) || StringUtils.isEmpty(code))&#123;
        throw new GuliException(20001,&quot;注册失败，注册信息不能为空&quot;);
    &#125;

    &#x2F;&#x2F; 判断验证码，从redis中取出来
    String mobileCode &#x3D; redisTemplate.opsForValue().get(mobile);
    if (!code.equals(mobileCode))&#123;
        throw new GuliException(20001,&quot;注册失败，验证码错误&quot;);
    &#125;
    &#x2F;&#x2F; 判断手机号码时候已经在数据库中
    QueryWrapper&lt;UcenterMember&gt; wrapper &#x3D; new QueryWrapper&lt;&gt;();
    wrapper.eq(&quot;mobile&quot;,mobile);
    Integer count &#x3D; baseMapper.selectCount(wrapper);

    if (count &gt; 0)&#123;
        &#x2F;&#x2F; 如果大于0，说明数据库中已经存在
        throw new GuliException(20001,&quot;注册失败，手机号已经存在&quot;);
    &#125;

    &#x2F;&#x2F; 将注册对象添加到数据库中
    UcenterMember ucenterMember &#x3D; new UcenterMember();
    ucenterMember.setNickname(registerVo.getNickname());
    ucenterMember.setMobile(registerVo.getMobile());
    ucenterMember.setPassword(MD5.encrypt(registerVo.getPassword()));
    ucenterMember.setIsDisabled(false);     &#x2F;&#x2F; 是否被禁用
    ucenterMember.setAvatar(&quot;http:&#x2F;&#x2F;thirdwx.qlogo.cn&#x2F;mmopen&#x2F;vi_32&#x2F;Q0j4TwGTfTKxCqRzuYWQmpwiaqQEjNxbC7WicebicXQusU306jgmfoOzUcFg1qaDq5BStiblwBjw5dUOblQ2gUicQOQ&#x2F;132&quot;);

    baseMapper.insert(ucenterMember);

&#125;</code></pre></div>



<p>测试，先往redis中存验证码，再用swagger测试。</p>
<h2 id="根据token获取用户信息接口"><a href="#根据token获取用户信息接口" class="headerlink" title="根据token获取用户信息接口"></a>根据token获取用户信息接口</h2><p>Controller</p>
<div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java">&#x2F;&#x2F; 根据token获取用户信息
@GetMapping(&quot;getMemberInfo&quot;)
public R getMemberInfo(HttpServletRequest request)&#123;
    &#x2F;&#x2F; 根据token获取用户信息
    String memberId &#x3D; JwtUtils.getMemberIdByJwtToken(request);

    &#x2F;&#x2F; 根据id查询用户对象
    UcenterMember member &#x3D; memberService.getById(memberId);
    return R.ok().data(&quot;userInfo&quot;,member);
&#125;</code></pre></div>



<h1 id="整合登录和注册页面"><a href="#整合登录和注册页面" class="headerlink" title="整合登录和注册页面"></a>整合登录和注册页面</h1><h2 id="一、在nuxt环境中安装插件"><a href="#一、在nuxt环境中安装插件" class="headerlink" title="一、在nuxt环境中安装插件"></a>一、在nuxt环境中安装插件</h2><h3 id="1、安装element-ui-和-vue-qriously"><a href="#1、安装element-ui-和-vue-qriously" class="headerlink" title="1、安装element-ui 和 vue-qriously"></a>1、安装element-ui 和 vue-qriously</h3><p>（1）执行命令安装</p>
<p>npm install element-ui</p>
<p>npm install vue-qriously</p>
<h3 id="2、修改配置文件-nuxt-swiper-plugin-js，使用插件"><a href="#2、修改配置文件-nuxt-swiper-plugin-js，使用插件" class="headerlink" title="2、修改配置文件 nuxt-swiper-plugin.js，使用插件"></a>2、修改配置文件 nuxt-swiper-plugin.js，使用插件</h3><p>nuxt-swiper-plugin.js</p>
<div class="code-wrapper"><pre class="line-numbers language-js" data-language="js"><code class="language-js">import Vue from &#39;vue&#39;
import VueAwesomeSwiper from &#39;vue-awesome-swiper&#x2F;dist&#x2F;ssr&#39;
import VueQriously from &#39;vue-qriously&#39;
import ElementUI from &#39;element-ui&#39; &#x2F;&#x2F;element-ui的全部组件
import &#39;element-ui&#x2F;lib&#x2F;theme-chalk&#x2F;index.css&#39;&#x2F;&#x2F;element-ui的css
Vue.use(ElementUI) &#x2F;&#x2F;使用elementUI
Vue.use(VueQriously)
Vue.use(VueAwesomeSwiper)</code></pre></div>

<h2 id="二、用户注册功能前端整合"><a href="#二、用户注册功能前端整合" class="headerlink" title="二、用户注册功能前端整合"></a>二、用户注册功能前端整合</h2><h3 id="1、在api文件夹中创建注册的js文件，定义接口"><a href="#1、在api文件夹中创建注册的js文件，定义接口" class="headerlink" title="1、在api文件夹中创建注册的js文件，定义接口"></a>1、在api文件夹中创建注册的js文件，定义接口</h3><p><strong>register.js</strong></p>
<div class="code-wrapper"><pre class="line-numbers language-js" data-language="js"><code class="language-js">import request from &#39;@&#x2F;utils&#x2F;request&#39;
export default &#123;
    &#x2F;&#x2F; 根据手机号码发送验证码
  getCode(mobile) &#123;
    return request(&#123;
      url: &#96;&#x2F;edumsm&#x2F;msm&#x2F;sendByPhone&#x2F;$&#123;mobile&#125;&#96;,
      method: &#39;get&#39;
    &#125;)
  &#125;,
  &#x2F;&#x2F; 注册
  registerMember(formItem)&#123;
    return request(&#123;
      url: &#96;&#x2F;educenter&#x2F;member&#x2F;register&#96;,
      method: &#39;post&#39;,
      data:formItem
    &#125;)
  &#125;
&#125;</code></pre></div>

<h3 id="2、在pages文件夹中创建注册页面，调用方法"><a href="#2、在pages文件夹中创建注册页面，调用方法" class="headerlink" title="2、在pages文件夹中创建注册页面，调用方法"></a>2、在pages文件夹中创建注册页面，调用方法</h3><p><strong>（1）在layouts创建布局页面</strong></p>
<p><strong>sign.vue</strong></p>
<div class="code-wrapper"><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;template&gt;
  &lt;div class&#x3D;&quot;sign&quot;&gt;
    &lt;!--标题--&gt;
    &lt;div class&#x3D;&quot;logo&quot;&gt;
      &lt;img src&#x3D;&quot;~&#x2F;assets&#x2F;img&#x2F;logo.png&quot; alt&#x3D;&quot;logo&quot;&gt;
    &lt;&#x2F;div&gt;
    &lt;!--表单--&gt;
    &lt;nuxt&#x2F;&gt;
  &lt;&#x2F;div&gt;
&lt;&#x2F;template&gt;</code></pre></div>

<p><strong>（2）创建注册页面</strong></p>
<p><strong>修改layouts文件夹里面default.vue页面，修改登录和注册超链接地址</strong></p>
<p><img src="/myBlog/day12-%E7%99%BB%E5%BD%95%E4%B8%9A%E5%8A%A1/image-20220107000912160.png" srcset="/myBlog/img/loading.gif" lazyload alt="image-20220107000912160"></p>
<p><strong>在pages文件夹下，创建注册和登录页面</strong></p>
<p><strong>register.vue</strong></p>
<div class="code-wrapper"><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;template&gt;
   &lt;div class&#x3D;&quot;main&quot;&gt;
     &lt;div class&#x3D;&quot;title&quot;&gt;
       &lt;a href&#x3D;&quot;&#x2F;login&quot;&gt;登录&lt;&#x2F;a&gt;
       &lt;span&gt;·&lt;&#x2F;span&gt;
       &lt;a class&#x3D;&quot;active&quot; href&#x3D;&quot;&#x2F;register&quot;&gt;注册&lt;&#x2F;a&gt;
     &lt;&#x2F;div&gt;
     &lt;div class&#x3D;&quot;sign-up-container&quot;&gt;
       &lt;el-form ref&#x3D;&quot;userForm&quot; :model&#x3D;&quot;params&quot;&gt;
         &lt;el-form-item class&#x3D;&quot;input-prepend restyle&quot; prop&#x3D;&quot;nickname&quot; :rules&#x3D;&quot;[&#123; required: true, message: &#39;请输入你的昵称&#39;, trigger: &#39;blur&#39; &#125;]&quot;&gt;
           &lt;div&gt;
             &lt;el-input type&#x3D;&quot;text&quot; placeholder&#x3D;&quot;你的昵称&quot; v-model&#x3D;&quot;params.nickname&quot;&#x2F;&gt;
             &lt;i class&#x3D;&quot;iconfont icon-user&quot;&#x2F;&gt;
           &lt;&#x2F;div&gt;
         &lt;&#x2F;el-form-item&gt;
         &lt;el-form-item class&#x3D;&quot;input-prepend restyle no-radius&quot; prop&#x3D;&quot;mobile&quot; :rules&#x3D;&quot;[&#123; required: true, message: &#39;请输入手机号码&#39;, trigger: &#39;blur&#39; &#125;,&#123;validator: checkPhone, trigger: &#39;blur&#39;&#125;]&quot;&gt;
           &lt;div&gt;
             &lt;el-input type&#x3D;&quot;text&quot; placeholder&#x3D;&quot;手机号&quot; v-model&#x3D;&quot;params.mobile&quot;&#x2F;&gt;
             &lt;i class&#x3D;&quot;iconfont icon-phone&quot;&#x2F;&gt;
           &lt;&#x2F;div&gt;
         &lt;&#x2F;el-form-item&gt;
         &lt;el-form-item class&#x3D;&quot;input-prepend restyle no-radius&quot; prop&#x3D;&quot;code&quot; :rules&#x3D;&quot;[&#123; required: true, message: &#39;请输入验证码&#39;, trigger: &#39;blur&#39; &#125;]&quot;&gt;
           &lt;div style&#x3D;&quot;width: 100%;display: block;float: left;position: relative&quot;&gt;
             &lt;el-input type&#x3D;&quot;text&quot; placeholder&#x3D;&quot;验证码&quot; v-model&#x3D;&quot;params.code&quot;&#x2F;&gt;
             &lt;i class&#x3D;&quot;iconfont icon-phone&quot;&#x2F;&gt;
           &lt;&#x2F;div&gt;
           &lt;div class&#x3D;&quot;btn&quot; style&#x3D;&quot;position:absolute;right: 0;top: 6px;width: 40%;&quot;&gt;
             &lt;a href&#x3D;&quot;javascript:&quot; type&#x3D;&quot;button&quot; @click&#x3D;&quot;getCodeFun()&quot; :value&#x3D;&quot;codeTest&quot; style&#x3D;&quot;border: none;background-color: none&quot;&gt;&#123;&#123;codeTest&#125;&#125;&lt;&#x2F;a&gt;
           &lt;&#x2F;div&gt;
         &lt;&#x2F;el-form-item&gt;
         &lt;el-form-item class&#x3D;&quot;input-prepend&quot; prop&#x3D;&quot;password&quot; :rules&#x3D;&quot;[&#123; required: true, message: &#39;请输入密码&#39;, trigger: &#39;blur&#39; &#125;]&quot;&gt;
           &lt;div&gt;
             &lt;el-input type&#x3D;&quot;password&quot; placeholder&#x3D;&quot;设置密码&quot; v-model&#x3D;&quot;params.password&quot;&#x2F;&gt;
             &lt;i class&#x3D;&quot;iconfont icon-password&quot;&#x2F;&gt;
           &lt;&#x2F;div&gt;
         &lt;&#x2F;el-form-item&gt;
         &lt;div class&#x3D;&quot;btn&quot;&gt;
           &lt;input type&#x3D;&quot;button&quot; class&#x3D;&quot;sign-up-button&quot; value&#x3D;&quot;注册&quot; @click&#x3D;&quot;submitRegister()&quot;&gt;
         &lt;&#x2F;div&gt;
         &lt;p class&#x3D;&quot;sign-up-msg&quot;&gt;
           点击 “注册” 即表示您同意并愿意遵守简书
           &lt;br&gt;
           &lt;a target&#x3D;&quot;_blank&quot; href&#x3D;&quot;http:&#x2F;&#x2F;www.jianshu.com&#x2F;p&#x2F;c44d171298ce&quot;&gt;用户协议&lt;&#x2F;a&gt;
           和
           &lt;a target&#x3D;&quot;_blank&quot; href&#x3D;&quot;http:&#x2F;&#x2F;www.jianshu.com&#x2F;p&#x2F;2ov8x3&quot;&gt;隐私政策&lt;&#x2F;a&gt; 。
         &lt;&#x2F;p&gt;
       &lt;&#x2F;el-form&gt;
       &lt;!-- 更多注册方式 --&gt;
       &lt;div class&#x3D;&quot;more-sign&quot;&gt;
         &lt;h6&gt;社交帐号直接注册&lt;&#x2F;h6&gt;
         &lt;ul&gt;
           &lt;li&gt;&lt;a id&#x3D;&quot;weixin&quot; class&#x3D;&quot;weixin&quot; target&#x3D;&quot;_blank&quot; href&#x3D;&quot;http:&#x2F;&#x2F;huaan.free.idcfengye.com&#x2F;api&#x2F;ucenter&#x2F;wx&#x2F;login&quot;&gt;&lt;i
             class&#x3D;&quot;iconfont icon-weixin&quot;&#x2F;&gt;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
           &lt;li&gt;&lt;a id&#x3D;&quot;qq&quot; class&#x3D;&quot;qq&quot; target&#x3D;&quot;_blank&quot; href&#x3D;&quot;#&quot;&gt;&lt;i class&#x3D;&quot;iconfont icon-qq&quot;&#x2F;&gt;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
         &lt;&#x2F;ul&gt;
       &lt;&#x2F;div&gt;
     &lt;&#x2F;div&gt;
   &lt;&#x2F;div&gt;
 &lt;&#x2F;template&gt;
 &lt;script&gt;
   import &#39;~&#x2F;assets&#x2F;css&#x2F;sign.css&#39;
   import &#39;~&#x2F;assets&#x2F;css&#x2F;iconfont.css&#39;
   import registerApi from &#39;@&#x2F;api&#x2F;register&#39;
   export default &#123;
     layout: &#39;sign&#39;,
     data() &#123;
       return &#123;
         params: &#123;
           mobile: &#39;&#39;,
           code: &#39;&#39;,
           nickname: &#39;&#39;,
           password: &#39;&#39;
         &#125;,
         sending: true,      &#x2F;&#x2F;是否发送验证码
         second: 60,        &#x2F;&#x2F;倒计时间
         codeTest: &#39;获取验证码&#39;
       &#125;
     &#125;,
     methods: &#123;
       &#x2F;&#x2F; 获取验证码
       getCodeFun()&#123;
         registerApi.getCode(this.params.mobile)
          .then(response &#x3D;&gt;&#123;
            this.sending &#x3D; false
            &#x2F;&#x2F; 倒计时
            this.timeDown()
          &#125;)
       &#125;,

      &#x2F;&#x2F; 倒计时
      timeDown() &#123;
        let result &#x3D; setInterval(() &#x3D;&gt; &#123;
          --this.second;
          this.codeTest &#x3D; this.second
          if (this.second &lt; 1) &#123;
            clearInterval(result);
            this.sending &#x3D; true;
            &#x2F;&#x2F;this.disabled &#x3D; false;
            this.second &#x3D; 60;
            this.codeTest &#x3D; &quot;获取验证码&quot;
          &#125;
        &#125;, 1000);

      &#125;,
       &#x2F;&#x2F; 注册
       submitRegister()&#123;
         registerApi.registerMember(this.params)
          .then(response &#x3D;&gt;&#123;
            &#x2F;&#x2F;提示注册成功
              this.$message(&#123;
                type: &#39;success&#39;,
                message: &quot;注册成功&quot;
              &#125;)
              
            &#x2F;&#x2F; 跳转至登录页面
            this.$router.push(&#123;path:&#39;&#x2F;login&#39;&#125;)
          &#125;)
       &#125;,
       
       checkPhone (rule, value, callback) &#123;
         &#x2F;&#x2F;debugger
         if (!(&#x2F;^1[34578]\d&#123;9&#125;$&#x2F;.test(value))) &#123;
           return callback(new Error(&#39;手机号码格式不正确&#39;))
         &#125;
         return callback()
       &#125;
     &#125;
   &#125;
&lt;&#x2F;script&gt;</code></pre></div>



<h2 id="三、用户登录功能前端整合"><a href="#三、用户登录功能前端整合" class="headerlink" title="三、用户登录功能前端整合"></a>三、用户登录功能前端整合</h2><p>登录功能流程分析：</p>
<p>1、 点击登录，调用接口返回登录的token信息</p>
<p>2、 将返回的token存放到cookie中</p>
<p>3、 创建拦截器，判断cookie中是否有token，如果有就将token设置到请求头header中</p>
<p>4、 根据token调用接口，返回用户信息</p>
<p>5、 根据返回的用户信息，在页面显示对应的数据</p>
<p><img src="/myBlog/day12-%E7%99%BB%E5%BD%95%E4%B8%9A%E5%8A%A1/image-20220107000936830.png" srcset="/myBlog/img/loading.gif" lazyload alt="image-20220107000936830"></p>
<h3 id="1、在api文件夹中创建登录的js文件，定义接口"><a href="#1、在api文件夹中创建登录的js文件，定义接口" class="headerlink" title="1、在api文件夹中创建登录的js文件，定义接口"></a>1、在api文件夹中创建登录的js文件，定义接口</h3><p><strong>login.js</strong></p>
<div class="code-wrapper"><pre class="line-numbers language-js" data-language="js"><code class="language-js">import request from &#39;@&#x2F;utils&#x2F;request&#39;
export default &#123;
    &#x2F;&#x2F; 登录
  submitLoginUser(userInfo) &#123;
    return request(&#123;
      url: &#96;&#x2F;educenter&#x2F;member&#x2F;login&#96;,
      method: &#39;post&#39;,
      data:userInfo
    &#125;)
  &#125;,
  &#x2F;&#x2F; 根据token获取用户信息
  getUserInfo()&#123;
    return request(&#123;
      url: &#96;&#x2F;educenter&#x2F;member&#x2F;getMemberInfo&#96;,
      method: &#39;get&#39;
    &#125;)
  &#125;
&#125;</code></pre></div>

<h3 id="2、在pages文件夹中创建登录页面，调用方法"><a href="#2、在pages文件夹中创建登录页面，调用方法" class="headerlink" title="2、在pages文件夹中创建登录页面，调用方法"></a>2、在pages文件夹中创建登录页面，调用方法</h3><p>（1）安装js-cookie插件</p>
<p>npm install js-cookie</p>
<p>（2）login.vue</p>
<div class="code-wrapper"><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;template&gt;
   &lt;div class&#x3D;&quot;main&quot;&gt;
     &lt;div class&#x3D;&quot;title&quot;&gt;
       &lt;a class&#x3D;&quot;active&quot; href&#x3D;&quot;&#x2F;login&quot;&gt;登录&lt;&#x2F;a&gt;
       &lt;span&gt;·&lt;&#x2F;span&gt;
       &lt;a href&#x3D;&quot;&#x2F;register&quot;&gt;注册&lt;&#x2F;a&gt;
     &lt;&#x2F;div&gt;
     &lt;div class&#x3D;&quot;sign-up-container&quot;&gt;
       &lt;el-form ref&#x3D;&quot;userForm&quot; :model&#x3D;&quot;user&quot;&gt;
         &lt;el-form-item class&#x3D;&quot;input-prepend restyle&quot; prop&#x3D;&quot;mobile&quot; :rules&#x3D;&quot;[&#123; required: true, message: &#39;请输入手机号码&#39;, trigger: &#39;blur&#39; &#125;,&#123;validator: checkPhone, trigger: &#39;blur&#39;&#125;]&quot;&gt;
           &lt;div &gt;
             &lt;el-input type&#x3D;&quot;text&quot; placeholder&#x3D;&quot;手机号&quot; v-model&#x3D;&quot;user.mobile&quot;&#x2F;&gt;
             &lt;i class&#x3D;&quot;iconfont icon-phone&quot; &#x2F;&gt;
           &lt;&#x2F;div&gt;
         &lt;&#x2F;el-form-item&gt;
         &lt;el-form-item class&#x3D;&quot;input-prepend&quot; prop&#x3D;&quot;password&quot; :rules&#x3D;&quot;[&#123; required: true, message: &#39;请输入密码&#39;, trigger: &#39;blur&#39; &#125;]&quot;&gt;
           &lt;div&gt;
             &lt;el-input type&#x3D;&quot;password&quot; placeholder&#x3D;&quot;密码&quot; v-model&#x3D;&quot;user.password&quot;&#x2F;&gt;
             &lt;i class&#x3D;&quot;iconfont icon-password&quot;&#x2F;&gt;
           &lt;&#x2F;div&gt;
         &lt;&#x2F;el-form-item&gt;
         &lt;div class&#x3D;&quot;btn&quot;&gt;
           &lt;input type&#x3D;&quot;button&quot; class&#x3D;&quot;sign-in-button&quot; value&#x3D;&quot;登录&quot; @click&#x3D;&quot;submitLogin()&quot;&gt;
         &lt;&#x2F;div&gt;
       &lt;&#x2F;el-form&gt;
       &lt;!-- 更多登录方式 --&gt;
       &lt;div class&#x3D;&quot;more-sign&quot;&gt;
         &lt;h6&gt;社交帐号登录&lt;&#x2F;h6&gt;
         &lt;ul&gt;
           &lt;li&gt;&lt;a id&#x3D;&quot;weixin&quot; class&#x3D;&quot;weixin&quot; target&#x3D;&quot;_blank&quot; href&#x3D;&quot;http:&#x2F;&#x2F;qy.free.idcfengye.com&#x2F;api&#x2F;ucenter&#x2F;weixinLogin&#x2F;login&quot;&gt;&lt;i class&#x3D;&quot;iconfont icon-weixin&quot;&#x2F;&gt;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
           &lt;li&gt;&lt;a id&#x3D;&quot;qq&quot; class&#x3D;&quot;qq&quot; target&#x3D;&quot;_blank&quot; href&#x3D;&quot;#&quot;&gt;&lt;i class&#x3D;&quot;iconfont icon-qq&quot;&#x2F;&gt;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
         &lt;&#x2F;ul&gt;
       &lt;&#x2F;div&gt;
     &lt;&#x2F;div&gt;
   &lt;&#x2F;div&gt;
 &lt;&#x2F;template&gt;
 &lt;script&gt;
   import &#39;~&#x2F;assets&#x2F;css&#x2F;sign.css&#39;
   import &#39;~&#x2F;assets&#x2F;css&#x2F;iconfont.css&#39;

   import cookie from &#39;js-cookie&#39;
   import loginApi from &#39;@&#x2F;api&#x2F;login&#39;
   export default &#123;
     layout: &#39;sign&#39;,
     data () &#123;
       return &#123;
         user:&#123;
           mobile:&#39;&#39;,
           password:&#39;&#39;
         &#125;,
         loginInfo:&#123;&#125;
       &#125;
     &#125;,
     methods: &#123;
       &#x2F;&#x2F; 登录
       submitLogin()&#123;
         &#x2F;&#x2F; 第一步调用接口获取登录token值
         loginApi.submitLoginUser(this.user)
          .then(response &#x3D;&gt;&#123;
            &#x2F;&#x2F; 第二步，将获取到的token值放到cookie中
            cookie.set(&#39;guli_token&#39;,response.data.data.token,&#123; domain: &#39;localhost&#39; &#125;)

            &#x2F;&#x2F; 第四步，根据token的值，调用接口，获取用户数据，并存入cookie中
            loginApi.getUserInfo()
              .then(response &#x3D;&gt;&#123;
                this.loginInfo &#x3D; response.data.data.userInfo
                &#x2F;&#x2F; 将得到的用户信息存入cookie中
                cookie.set(&quot;guli_ucenter&quot;,JSON.stringify(this.loginInfo),&#123; domain: &#39;localhost&#39; &#125;)
                &#x2F;&#x2F; 跳转页面
                window.location.href &#x3D; &quot;&#x2F;&quot;
              &#125;)
          &#125;)
          
       &#125;,
       checkPhone (rule, value, callback) &#123;
         &#x2F;&#x2F;debugger
         if (!(&#x2F;^1[34578]\d&#123;9&#125;$&#x2F;.test(value))) &#123;
           return callback(new Error(&#39;手机号码格式不正确&#39;))
         &#125;
         return callback()
       &#125;
     &#125;
   &#125;
 &lt;&#x2F;script&gt;

&lt;style&gt;

   .el-form-item__error&#123;

    z-index: 9999999;

  &#125;

&lt;&#x2F;style&gt;</code></pre></div>



<h3 id="3、在request-js添加拦截器，用于传递token信息"><a href="#3、在request-js添加拦截器，用于传递token信息" class="headerlink" title="3、在request.js添加拦截器，用于传递token信息"></a>3、在request.js添加拦截器，用于传递token信息</h3><div class="code-wrapper"><pre class="line-numbers language-js" data-language="js"><code class="language-js">
import axios from &#39;axios&#39;
import cookie from &#39;js-cookie&#39;
import &#123; MessageBox, Message &#125; from &#39;element-ui&#39;
&#x2F;&#x2F; 创建axios实例
const service &#x3D; axios.create(&#123;
  baseURL: &#39;http:&#x2F;&#x2F;localhost:9001&#39;, &#x2F;&#x2F; api的base_url
  timeout: 20000 &#x2F;&#x2F; 请求超时时间
&#125;)

&#x2F;&#x2F; 第三步，编写一个拦截器
&#x2F;&#x2F; http request 拦截器
service.interceptors.request.use(
  config &#x3D;&gt; &#123;
  &#x2F;&#x2F;debugger
  if (cookie.get(&#39;guli_token&#39;)) &#123;
    &#x2F;&#x2F; 将token的值存入到请求头中
    config.headers[&#39;token&#39;] &#x3D; cookie.get(&#39;guli_token&#39;);
  &#125;
    return config
  &#125;,
  err &#x3D;&gt; &#123;
  return Promise.reject(err);
&#125;)

&#x2F;&#x2F; http response 拦截器
service.interceptors.response.use(
  response &#x3D;&gt; &#123;
    &#x2F;&#x2F;debugger
    if (response.data.code &#x3D;&#x3D; 28004) &#123;
        console.log(&quot;response.data.resultCode是28004&quot;)
        &#x2F;&#x2F; 返回 错误代码-1 清除ticket信息并跳转到登录页面
        &#x2F;&#x2F;debugger
        window.location.href&#x3D;&quot;&#x2F;login&quot;
        return
    &#125;else&#123;
      if (response.data.code !&#x3D;&#x3D; 20000) &#123;
        &#x2F;&#x2F;25000：订单支付中，不做任何提示
        if(response.data.code !&#x3D; 25000) &#123;
          Message(&#123;
            message: response.data.message || &#39;error&#39;,
            type: &#39;error&#39;,
            duration: 5 * 1000
          &#125;)
        &#125;
      &#125; else &#123;
        return response;
      &#125;
    &#125;
  &#125;,
  error &#x3D;&gt; &#123;
    return Promise.reject(error.response)   &#x2F;&#x2F; 返回接口返回的错误信息
&#125;);

export default service</code></pre></div>



<h3 id="4、修改layouts中的default-vue页面"><a href="#4、修改layouts中的default-vue页面" class="headerlink" title="4、修改layouts中的default.vue页面"></a>4、修改layouts中的default.vue页面</h3><p>（1）显示登录之后的用户信息</p>
<div class="code-wrapper"><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;script&gt;
 import &quot;~&#x2F;assets&#x2F;css&#x2F;reset.css&quot;;
 import &quot;~&#x2F;assets&#x2F;css&#x2F;theme.css&quot;;
 import &quot;~&#x2F;assets&#x2F;css&#x2F;global.css&quot;;
 import &quot;~&#x2F;assets&#x2F;css&#x2F;web.css&quot;;
   import cookie from &#39;js-cookie&#39;
   import loginApi from &#39;@&#x2F;api&#x2F;login&#39;
 export default &#123;
   data()&#123;
     return&#123;
      token: &#39;&#39;,
      loginInfo: &#123;
        id: &#39;&#39;,
        age: &#39;&#39;,
        avatar: &#39;&#39;,
        mobile: &#39;&#39;,
        nickname: &#39;&#39;,
        sex: &#39;&#39;
      &#125;
     &#125;
   &#125;,
   created()&#123;
    this.showUserInfo()
   &#125;,
   methods:&#123;
     &#x2F;&#x2F; 显示用户信息，从cookie中取出用户信息
     showUserInfo()&#123;
       loginApi.getUserInfo()
       .then(response &#x3D;&gt;&#123;
         &#x2F;&#x2F; 第五步，从cookie中取出用户信息，取出来的是字符串
          var userStr &#x3D; cookie.get(&quot;guli_ucenter&quot;)
          &#x2F;&#x2F; 判断取出来的字符串是有为空
          if(userStr)&#123;
          &#x2F;&#x2F; 将取出来的字符串转为json，并赋值给loginInfo
          this.loginInfo &#x3D; JSON.parse(userStr)
          &#125;

       &#125;)
     &#125;
   &#125;
 &#125;;
 &lt;&#x2F;script&gt;</code></pre></div>



<p>（2）default.vue页面显示登录之后的用户信息</p>
<div class="code-wrapper"><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;!-- &#x2F; nav --&gt;
          &lt;ul class&#x3D;&quot;h-r-login&quot;&gt;
              &lt;li v-if&#x3D;&quot;!loginInfo.id&quot; id&#x3D;&quot;no-login&quot;&gt;
                  &lt;a href&#x3D;&quot;&#x2F;login&quot; title&#x3D;&quot;登录&quot;&gt;
                      &lt;em class&#x3D;&quot;icon18 login-icon&quot;&gt;&amp;nbsp;&lt;&#x2F;em&gt;
                      &lt;span class&#x3D;&quot;vam ml5&quot;&gt;登录&lt;&#x2F;span&gt;
                  &lt;&#x2F;a&gt;
                  |
                  &lt;a href&#x3D;&quot;&#x2F;register&quot; title&#x3D;&quot;注册&quot;&gt;
                      &lt;span class&#x3D;&quot;vam ml5&quot;&gt;注册&lt;&#x2F;span&gt;
                  &lt;&#x2F;a&gt;
              &lt;&#x2F;li&gt;
              &lt;li v-if&#x3D;&quot;loginInfo.id&quot; id&#x3D;&quot;is-login-one&quot; class&#x3D;&quot;mr10&quot;&gt;
                  &lt;a id&#x3D;&quot;headerMsgCountId&quot; href&#x3D;&quot;#&quot; title&#x3D;&quot;消息&quot;&gt;
                      &lt;em class&#x3D;&quot;icon18 news-icon&quot;&gt;&amp;nbsp;&lt;&#x2F;em&gt;
                  &lt;&#x2F;a&gt;
                  &lt;q class&#x3D;&quot;red-point&quot; style&#x3D;&quot;display: none&quot;&gt;&amp;nbsp;&lt;&#x2F;q&gt;
              &lt;&#x2F;li&gt;
              &lt;li v-if&#x3D;&quot;loginInfo.id&quot; id&#x3D;&quot;is-login-two&quot; class&#x3D;&quot;h-r-user&quot;&gt;
                  &lt;a href&#x3D;&quot;&#x2F;ucenter&quot; title&gt;
                      &lt;img
                            :src&#x3D;&quot;loginInfo.avatar&quot;
                            width&#x3D;&quot;30&quot;
                            height&#x3D;&quot;30&quot;
                            class&#x3D;&quot;vam picImg&quot;
                            alt
                            &gt;
                      &lt;span id&#x3D;&quot;userName&quot; class&#x3D;&quot;vam disIb&quot;&gt;&#123;&#123; loginInfo.nickname &#125;&#125;&lt;&#x2F;span&gt;
                  &lt;&#x2F;a&gt;
                  &lt;a href&#x3D;&quot;javascript:void(0);&quot; title&#x3D;&quot;退出&quot; @click&#x3D;&quot;logout()&quot; class&#x3D;&quot;ml5&quot;&gt;退出&lt;&#x2F;a&gt;
              &lt;&#x2F;li&gt;
              &lt;!-- &#x2F;未登录显示第1 li；登录后显示第2，3 li --&gt;
          &lt;&#x2F;ul&gt;</code></pre></div>



<h2 id="退出登录"><a href="#退出登录" class="headerlink" title="退出登录"></a>退出登录</h2><p>methods</p>
<div class="code-wrapper"><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&#x2F;&#x2F; 退出登录
logout()&#123;
  cookie.set(&#39;guli_token&#39;,&#39;&#39;,&#123; domain: &#39;localhost&#39; &#125;)
  cookie.set(&quot;guli_ucenter&quot;,&#39;&#39;,&#123; domain: &#39;localhost&#39; &#125;)

  &#x2F;&#x2F; 跳转页面
  window.location.href &#x3D; &quot;&#x2F;&quot;
&#125;</code></pre></div>


              
            </div>
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/myBlog/categories/%E9%A1%B9%E7%9B%AE-%E8%B0%B7%E7%B2%92%E5%AD%A6%E9%99%A2-%E7%AC%94%E8%AE%B0/" class="category-chain-item">项目|谷粒学院|笔记</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/myBlog/tags/project/">#project</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>day12-登录业务</div>
      <div>https://no-ten.github.io/day12-登录业务/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Ten</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2022年1月7日</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>许可协议</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - 署名">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/myBlog/day13-%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95/" title="day13-微信登录">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">day13-微信登录</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/myBlog/day11-%E9%A6%96%E9%A1%B5%E6%95%B0%E6%8D%AE%E6%98%BE%E7%A4%BA/" title="day11-首页数据显示">
                        <span class="hidden-mobile">day11-首页数据显示</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/myBlog/js/events.js" ></script>
<script  src="/myBlog/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>






  
    <script  src="/myBlog/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.0/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script  src="https://lib.baomitu.com/prism/1.26.0/components/prism-core.min.js" ></script>

  <script  src="https://lib.baomitu.com/prism/1.26.0/plugins/autoloader/prism-autoloader.min.js" ></script>

  <script  src="https://lib.baomitu.com/prism/1.26.0/plugins/line-numbers/prism-line-numbers.min.js" ></script>

  <script>
  (function() {
    var enableLang = CONFIG.code_language.enable && CONFIG.code_language.default;
    var enableCopy = CONFIG.copy_btn;
    if (!enableLang && !enableCopy) {
      return;
    }

    function getBgClass(ele) {
      return Fluid.utils.getBackgroundLightness(ele) >= 0 ? 'code-widget-light' : 'code-widget-dark';
    }

    var copyTmpl = '';
    copyTmpl += '<div class="code-widget">';
    copyTmpl += 'LANG';
    copyTmpl += '</div>';
    jQuery('.markdown-body pre').each(function() {
      var $pre = jQuery(this);
      if ($pre.find('code.mermaid').length > 0) {
        return;
      }
      if ($pre.find('span.line').length > 0) {
        return;
      }

      var lang = '';

      if (enableLang) {
        lang = CONFIG.code_language.default;
        if ($pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2 && $pre.children().hasClass('hljs')) {
          lang = $pre[0].children[0].classList[1];
        } else if ($pre[0].getAttribute('data-language')) {
          lang = $pre[0].getAttribute('data-language');
        } else if ($pre.parent().hasClass('sourceCode') && $pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2) {
          lang = $pre[0].children[0].classList[1];
          $pre.parent().addClass('code-wrapper');
        } else if ($pre.parent().hasClass('markdown-body') && $pre[0].classList.length === 0) {
          $pre.wrap('<div class="code-wrapper"></div>');
        }
        lang = lang.toUpperCase().replace('NONE', CONFIG.code_language.default);
      }
      $pre.append(copyTmpl.replace('LANG', lang).replace('code-widget">',
        getBgClass($pre[0]) + (enableCopy ? ' code-widget copy-btn" data-clipboard-snippet><i class="iconfont icon-copy"></i>' : ' code-widget">')));

      if (enableCopy) {
        Fluid.utils.createScript('https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js', function() {
          var clipboard = new window.ClipboardJS('.copy-btn', {
            target: function(trigger) {
              var nodes = trigger.parentNode.childNodes;
              for (var i = 0; i < nodes.length; i++) {
                if (nodes[i].tagName === 'CODE') {
                  return nodes[i];
                }
              }
            }
          });
          clipboard.on('success', function(e) {
            e.clearSelection();
            e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-copy', 'icon-success');
            setTimeout(function() {
              e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-success', 'icon-copy');
            }, 2000);
          });
        });
      }
    });
  })();
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/myBlog/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/myBlog/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
